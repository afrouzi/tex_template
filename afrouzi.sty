%% Import regular packages 
\usepackage[T1]{fontenc}
\usepackage[latin9]{luainputenc}

% Font package: fourier by default which uses Adobe Utopia
\usepackage{fourier}

% https://ctan.org/pkg/microtype?lang=en
\usepackage{microtype}

% \caps{Small Caps}, \so{letter_spacing}, \ul{underline}, \st{overstriking}
\usepackage{soul}

% for tables: https://ctan.org/pkg/array?lang=en, https://ctan.org/pkg/multirow, https://ctan.org/pkg/booktabs
\usepackage{array}
\usepackage{multirow} 
\usepackage{booktabs}
    % default table size --- this creates an issue for author font size
    \newcommand{\mytablefontsize}{\normalfont} % or \small or \scriptsize --- this also changes the author font size ...
    \AtBeginEnvironment{table}{\mytablefontsize}

% support for placement of figures/tables: https://ctan.org/pkg/float
\usepackage{float}

% for line-spacing: \singlespacing, \doublespacing, \onehalfspacing
\usepackage{setspace}

% for landscape figures/tables https://ctan.org/pkg/lscape
\usepackage{lscape}
% rotate landscape pages in the pdf 
\usepackage{pdflscape}

% nice fractions 
\usepackage{nicefrac}

% for math environments and operators: https://ctan.org/pkg/amsmath
% envs: equation, align, gather, multiline, alignat, flalign, split
\usepackage{amsmath}
    % allow for page breaks in the middle of equation blocks
    \allowdisplaybreaks[1] 

% for theorems: https://ctan.org/pkg/amsthm, https://ctan.org/pkg/thmtools
\usepackage{amsthm} 
\usepackage{thmtools}
    % theorem/proposition style - colored with blue
    \declaretheoremstyle[
    spaceabove=2pt, spacebelow=2pt,
    headfont=\color{darkblue}\normalfont\bfseries,
    notefont=\mdseries\bfseries, notebraces={(}{)},
    bodyfont=\color{darkblue}\normalfont
    ]{thmstyle}

    % lemma, corollary style
    \declaretheoremstyle[
    spaceabove=2pt, spacebelow=2pt,
    headfont=\normalfont\bfseries,
    notefont=\mdseries\bfseries, notebraces={(}{)},
    bodyfont=\normalfont\itshape,
    ]{lemstyle}

    % envs: thm, prop, remark, lem, cor, defn, defn*, algorithm, proof
    \declaretheorem[style=thmstyle,name=Theorem]{thm}
    \declaretheorem[style=thmstyle,name=Proposition,sibling=thm]{prop}
    \declaretheorem[style=thmstyle,name=Remark]{remark}
    \declaretheorem[style=lemstyle,name=Lemma,sibling=thm]{lem}
    \declaretheorem[style=lemstyle,name=Corollary,sibling=thm]{cor}
    \declaretheorem[style=lemstyle,name=Definition]{defn}
    \declaretheorem[style=lemstyle,name=Definition,numbered=no]{defn*}
    \declaretheorem[style=lemstyle,name=Algorithm]{algorithm}
    \renewcommand{\qedsymbol}{\rule{1.2ex}{1.2ex}}
    \renewenvironment{proof}[1][\proofname]{\par
        \pushQED{\qed}%
        \normalfont \topsep2\p@\@plus6\p@\relax
        \trivlist
        \item\relax
        {\itshape
        #1\@addpunct{.}}\hspace\labelsep\ignorespaces
        }{%
        \popQED\endtrivlist\@endpefalse
    }

% for mathemtical symbols
\usepackage{amssymb}

% for bibliography
\usepackage[longnamesfirst,authoryear]{natbib}
	\setlength{\bibsep}{2pt plus 0.3ex}
    \newcommand{\printreferences}{
        \begin{singlespace}
        {\small 
        \bibliographystyle{\mybibstyle}
        \bibliography{\mybibfile}}
        \end{singlespace}
    }

% to import tex files into main.tex
\usepackage{import}

% to have colored hyperlinks
\usepackage{hyperref}
    \hypersetup{colorlinks=true,linkcolor=darkred,citecolor=darkred,urlcolor=darkmagenta}
    \newcommand{\email}[1]{\href{mailto:#1}{#1}}

% clever references
\usepackage[capitalise,noabbrev]{cleveref}
    \crefname{thm}{Theorem}{Theorems}
    \crefname{lem}{Lemma}{Lemmas}
    \crefname{defn}{Definition}{Definitions}
    \crefname{prop}{Proposition}{Propositions}

% for appendix: https://ctan.org/pkg/appendix, https://ctan.org/pkg/apptools
\usepackage{appendix} % \appendix
\usepackage{apptools} % \AtAppendix, \IfAppendix
    \AtAppendix{
        \counterwithin{prop}{section}
        \counterwithin{lem}{section}
        \counterwithin{cor}{section}
        \counterwithin{table}{section}
        \counterwithin{figure}{section}
        \numberwithin{equation}{section}
    }
    \newcommand{\onlineappendixheader}{
        \newpage
        \thispagestyle{empty}
        \vspace*{\fill}
        \begin{center}
        \textbf{{\huge APPENDIX}  \\ {\Large(FOR ONLINE PUBLICATION)}}
        \end{center}
        \vspace*{\fill}
        \newpage
    }

% for captions:
\usepackage{caption}
    \captionsetup{belowskip=2pt,aboveskip=2pt}
    % for table and figure notes:
    \newcommand\notes[1]{\captionsetup{belowskip=0pt,aboveskip=2pt,font={footnotesize,stretch=1},justification=justified}\caption*{\emph{Notes:} #1}}
\usepackage{subcaption}

% for plots and figures:
\usepackage{tikz}
\usepackage{pgfplots}
    \pgfplotsset{compat=1.13}

% could be used to redefine url styles: https://ctan.org/pkg/url
\usepackage{url}

% space before and after section/subsection/paragraph titles 
\usepackage{titlesec}
    \titlespacing*{\section}{0pt}{1.5ex plus 1ex minus .2ex}{1.5ex plus 1ex minus .2ex}
    \titlespacing*{\subsection}{0pt}{1.25ex plus 0.8ex minus .2ex}{1ex plus 0.5ex minus .2ex}
    \titlespacing*{\subsubsection}{0pt}{1ex plus 0.6ex minus .2ex}{1ex plus 0.5ex minus .2ex}
    \titlespacing*{\paragraph}{0pt}{0.6ex plus .2ex minus .2ex}{0.6ex plus 0.2ex minus .2ex}

% no space between items in lists (itemize, enumerate)
\usepackage{enumitem}
    \setlist{nosep}

% control space before and after equation environments:
\usepackage{etoolbox}
    \newcommand{\zerodisplayskips}{%
      \setlength{\abovedisplayskip}{1ex}%
      \setlength{\belowdisplayskip}{1ex}%
      \setlength{\abovedisplayshortskip}{1ex}%
      \setlength{\belowdisplayshortskip}{1ex}}
    \appto{\normalsize}{\zerodisplayskips}
    \appto{\small}{\zerodisplayskips}
    \appto{\footnotesize}{\zerodisplayskips}

% where to compile eps figures to pdf
\usepackage[outdir=./content/figures/]{epstopdf}

% for margins (see declare options below)
\usepackage{geometry}
    \geometry{tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}

% options for \includegraphics: https://ctan.org/pkg/graphicx
\usepackage{graphicx}
    % set scaling of figures (by default it is 1)
    \newcommand{\myfigurescale}{1} % or < 1
    \setkeys{Gin}{width=\myfigurescale\textwidth}

% \usepackage{xcolor}

%% PRETTY COLORS
\definecolor{darkred}{rgb}{0.5, 0.125, 0.0}
\definecolor{darkgreen}{rgb}{0.0, 0.4, 0.2}
\definecolor{darkblue}{rgb}{0.0, 0.125, 0.5}
\definecolor{darkmagenta}{rgb}{0.5, 0.25, 0.5}

%% DECLARE OPTIONS
% if for building the title page 
\newif\ifbuildtitle
\buildtitletrue
\DeclareOption{note}{\buildtitlefalse}
% if for comments
\newif\ifcomments
\commentsfalse
\DeclareOption{comments}{\commentstrue}
\DeclareOption{ecma}{
    \geometry{tmargin=1.5in,bmargin=1.5in,lmargin=1.5in,rmargin=1.5in}
    }
\DeclareOption{aer}{
    \geometry{tmargin=1.25in,bmargin=1.25in,lmargin=1.25in,rmargin=1.25in}
    }
\DeclareOption{qje}{
    % ROMAN NUMBERS FOR QJE
    \renewcommand{\thetable}{\Roman{table}}
    \renewcommand{\thefigure}{\Roman{figure}}
    }        
\ProcessOptions\relax

%% TITLE/AUTHORS/AFFILIATIONS
%% MAKE TITLE
\ifbuildtitle
\title{\mytitle\thanks{\mytitlefootnote}}
\author{\myauthors}
\date{\normalsize{\mydate}} 
\AtBeginDocument{
    \maketitle
    \thispagestyle{empty}
    \begin{abstract}
        \begin{singlespace}
    \myabstract
    \vspace{\baselineskip} \\
    \noindent \emph{JEL Codes:} \myjelcodes \\
    \noindent \emph{Key Words:} \mykeywords
        \end{singlespace}
    \end{abstract}
    \newpage{}
    \pagenumbering{arabic}
}
\fi

%%EXPAND THE MARGIN FOR COMMENTS
\ifcomments
  \paperwidth=\dimexpr \paperwidth + 3cm\relax
  \oddsidemargin=\dimexpr\oddsidemargin \relax
  \evensidemargin=\dimexpr\evensidemargin + 3cm\relax
  \marginparwidth=\dimexpr \marginparwidth + 3cm\relax
  \usepackage{todonotes}
\else
  \usepackage[disable]{todonotes}
\fi 

% define comment author: \commentauthor{Author}{command}{color}
\newcommand{\commentauthor}[3]{
    \newcommand{#2}[1]{\todo[color=#3!30, size=\scriptsize]
     {\begin{spacing}{1}\textbf{#1:} \\ \texttt{##1}\end{spacing}}}
}

%% OTHER COMMANDS:
\renewcommand{\d}{\mathrm{d}}
\newcommand{\eqlabel}[2]{\underset{\text{#1}}{\underbrace{#2}}}